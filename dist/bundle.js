(() => {
  // src/config/models.js
  var MODELS = {
    "BE-Articles": {
      "createdAt": "2025-09-10T19:32:22.632Z",
      "url": "https://live-74999-petcare-purinattt-belgium.pantheonsite.io/fr/node/10633/edit",
      "items": [
        {
          "id": "au0xkohly4fmfbgf81j",
          "ts": "2025-09-08T18:27:37.207Z",
          "url": "https://live-74999-petcare-purinattt-belgium.pantheonsite.io/nl/node/10630/edit?destination=/fr/admin/content%3Ftitle%3D%26type%3Dnppe_article%26langcode%3DAll%26moderation_state%3DAll",
          "title": "Edit Article De 100 beste namen waarop je kater gek zal zijn - Cloned [Dutch translation] | Purina BE",
          "field": {
            "label": "Body",
            "type": "textarea:textarea",
            "name": "field_article_lp_components[0][subform][field_c_text][0][value]",
            "id": "edit-field-article-lp-components-0-subform-field-c-text-0-value--vQapU4H8LA8",
            "dataDrupalSelector": "edit-field-article-lp-components-0-subform-field-c-text-0-value",
            "cssSelector": "#edit-field-article-lp-components-0-subform-field-c-text-0-value--vQapU4H8LA8",
            "wrapperSelector": "#edit-field-article-lp-components-0-subform-field-c-text-0-value--vQapU4H8LA8",
            "editor": "ckeditor"
          },
          "drupal": {
            "component": "field_article_lp_components",
            "componentIndex": 0,
            "subfield": "field_c_text",
            "subfieldIndex": 0,
            "property": "value",
            "nameTokens": [
              "field_article_lp_components",
              "0",
              "subform",
              "field_c_text",
              "0",
              "value"
            ]
          },
          "note": "Intro, must be h3"
        },
        {
          "id": "444hxgnavqxmfbgfaym",
          "ts": "2025-09-08T18:27:40.990Z",
          "url": "https://live-74999-petcare-purinattt-belgium.pantheonsite.io/nl/node/10630/edit?destination=/fr/admin/content%3Ftitle%3D%26type%3Dnppe_article%26langcode%3DAll%26moderation_state%3DAll",
          "title": "Edit Article De 100 beste namen waarop je kater gek zal zijn - Cloned [Dutch translation] | Purina BE",
          "field": {
            "label": "Body",
            "type": "textarea:textarea",
            "name": "field_article_lp_components[1][subform][field_c_text][0][value]",
            "id": "edit-field-article-lp-components-1-subform-field-c-text-0-value--iUJHCcCCZDQ",
            "dataDrupalSelector": "edit-field-article-lp-components-1-subform-field-c-text-0-value",
            "cssSelector": "#edit-field-article-lp-components-1-subform-field-c-text-0-value--iUJHCcCCZDQ",
            "wrapperSelector": "#edit-field-article-lp-components-1-subform-field-c-text-0-value--iUJHCcCCZDQ",
            "editor": "ckeditor"
          },
          "drupal": {
            "component": "field_article_lp_components",
            "componentIndex": 1,
            "subfield": "field_c_text",
            "subfieldIndex": 0,
            "property": "value",
            "nameTokens": [
              "field_article_lp_components",
              "1",
              "subform",
              "field_c_text",
              "0",
              "value"
            ]
          },
          "note": "First text block, will receive text with bold, italic, heading, listst and hyperlink"
        },
        {
          "id": "nroefvbbhnfmfbgfeg2",
          "ts": "2025-09-08T18:27:45.506Z",
          "url": "https://live-74999-petcare-purinattt-belgium.pantheonsite.io/nl/node/10630/edit?destination=/fr/admin/content%3Ftitle%3D%26type%3Dnppe_article%26langcode%3DAll%26moderation_state%3DAll",
          "title": "Edit Article De 100 beste namen waarop je kater gek zal zijn - Cloned [Dutch translation] | Purina BE",
          "field": {
            "label": "Inhoud",
            "type": "textarea:textarea",
            "name": "field_article_lp_components[2][subform][field_c_sideimagetext_summary][0][value]",
            "id": "edit-field-article-lp-components-2-subform-field-c-sideimagetext-summary-0-value--Quf7cXw7xO8",
            "dataDrupalSelector": "edit-field-article-lp-components-2-subform-field-c-sideimagetext-summary-0-value",
            "cssSelector": "#edit-field-article-lp-components-2-subform-field-c-sideimagetext-summary-0-value--Quf7cXw7xO8",
            "wrapperSelector": "#edit-field-article-lp-components-2-subform-field-c-sideimagetext-summary-0-value--Quf7cXw7xO8",
            "editor": "ckeditor"
          },
          "drupal": {
            "component": "field_article_lp_components",
            "componentIndex": 2,
            "subfield": "field_c_sideimagetext_summary",
            "subfieldIndex": 0,
            "property": "value",
            "nameTokens": [
              "field_article_lp_components",
              "2",
              "subform",
              "field_c_sideimagetext_summary",
              "0",
              "value"
            ]
          },
          "note": "First Image+Text\nWill recieve max 2 <p> with max 500 characters, suggest to move next p to next block if necessary"
        },
        {
          "id": "t7x5k8witcmfbgfh5t",
          "ts": "2025-09-08T18:27:49.025Z",
          "url": "https://live-74999-petcare-purinattt-belgium.pantheonsite.io/nl/node/10630/edit?destination=/fr/admin/content%3Ftitle%3D%26type%3Dnppe_article%26langcode%3DAll%26moderation_state%3DAll",
          "title": "Edit Article De 100 beste namen waarop je kater gek zal zijn - Cloned [Dutch translation] | Purina BE",
          "field": {
            "label": "Body",
            "type": "textarea:textarea",
            "name": "field_article_lp_components[3][subform][field_c_text][0][value]",
            "id": "edit-field-article-lp-components-3-subform-field-c-text-0-value--o-YYeSJ0yJI",
            "dataDrupalSelector": "edit-field-article-lp-components-3-subform-field-c-text-0-value",
            "cssSelector": "#edit-field-article-lp-components-3-subform-field-c-text-0-value--o-YYeSJ0yJI",
            "wrapperSelector": "#edit-field-article-lp-components-3-subform-field-c-text-0-value--o-YYeSJ0yJI",
            "editor": "ckeditor"
          },
          "drupal": {
            "component": "field_article_lp_components",
            "componentIndex": 3,
            "subfield": "field_c_text",
            "subfieldIndex": 0,
            "property": "value",
            "nameTokens": [
              "field_article_lp_components",
              "3",
              "subform",
              "field_c_text",
              "0",
              "value"
            ]
          },
          "note": "Second text block, will receive text with bold, italic, heading, listst and hyperlink"
        },
        {
          "id": "9uvzz505w9tmfbgfknh",
          "ts": "2025-09-08T18:27:53.549Z",
          "url": "https://live-74999-petcare-purinattt-belgium.pantheonsite.io/nl/node/10630/edit?destination=/fr/admin/content%3Ftitle%3D%26type%3Dnppe_article%26langcode%3DAll%26moderation_state%3DAll",
          "title": "Edit Article De 100 beste namen waarop je kater gek zal zijn - Cloned [Dutch translation] | Purina BE",
          "field": {
            "label": "Inhoud",
            "type": "textarea:textarea",
            "name": "field_article_lp_components[4][subform][field_c_sideimagetext_summary][0][value]",
            "id": "edit-field-article-lp-components-4-subform-field-c-sideimagetext-summary-0-value--lniD_3q0Clw",
            "dataDrupalSelector": "edit-field-article-lp-components-4-subform-field-c-sideimagetext-summary-0-value",
            "cssSelector": "#edit-field-article-lp-components-4-subform-field-c-sideimagetext-summary-0-value--lniD_3q0Clw",
            "wrapperSelector": "#edit-field-article-lp-components-4-subform-field-c-sideimagetext-summary-0-value--lniD_3q0Clw",
            "editor": "ckeditor"
          },
          "drupal": {
            "component": "field_article_lp_components",
            "componentIndex": 4,
            "subfield": "field_c_sideimagetext_summary",
            "subfieldIndex": 0,
            "property": "value",
            "nameTokens": [
              "field_article_lp_components",
              "4",
              "subform",
              "field_c_sideimagetext_summary",
              "0",
              "value"
            ]
          },
          "note": "Second Image+Text\nWill recieve max 2 <p> with max 500 characters, suggest to move next p to next block if necessary"
        },
        {
          "id": "cny2k2o5wfimfbgfqm9",
          "ts": "2025-09-08T18:28:01.281Z",
          "url": "https://live-74999-petcare-purinattt-belgium.pantheonsite.io/nl/node/10630/edit?destination=/fr/admin/content%3Ftitle%3D%26type%3Dnppe_article%26langcode%3DAll%26moderation_state%3DAll",
          "title": "Edit Article De 100 beste namen waarop je kater gek zal zijn - Cloned [Dutch translation] | Purina BE",
          "field": {
            "label": "Body",
            "type": "textarea:textarea",
            "name": "field_article_lp_components[5][subform][field_c_text][0][value]",
            "id": "edit-field-article-lp-components-5-subform-field-c-text-0-value--fCPRRXd3QrA",
            "dataDrupalSelector": "edit-field-article-lp-components-5-subform-field-c-text-0-value",
            "cssSelector": "#edit-field-article-lp-components-5-subform-field-c-text-0-value--fCPRRXd3QrA",
            "wrapperSelector": "#edit-field-article-lp-components-5-subform-field-c-text-0-value--fCPRRXd3QrA",
            "editor": "ckeditor"
          },
          "drupal": {
            "component": "field_article_lp_components",
            "componentIndex": 5,
            "subfield": "field_c_text",
            "subfieldIndex": 0,
            "property": "value",
            "nameTokens": [
              "field_article_lp_components",
              "5",
              "subform",
              "field_c_text",
              "0",
              "value"
            ]
          },
          "note": "Final text block, will receive text with bold, italic, heading, listst and hyperlink"
        },
        {
          "id": "fvnt8aktg9dmfbhrqo1",
          "ts": "2025-09-08T19:05:20.833Z",
          "url": "https://live-74999-petcare-purinattt-belgium.pantheonsite.io/nl/node/10630/edit?destination=/fr/admin/content%3Ftitle%3D%26type%3Dnppe_article%26langcode%3DAll%26moderation_state%3DAll",
          "title": "Edit Article De 100 beste namen waarop je kater gek zal zijn - Cloned [Dutch translation] | Purina BE",
          "field": {
            "label": "Page title",
            "type": "input:text",
            "name": "field_meta_tags[0][basic][title]",
            "id": "edit-field-meta-tags-0-basic-title",
            "dataDrupalSelector": "edit-field-meta-tags-0-basic-title",
            "cssSelector": "#edit-field-meta-tags-0-basic-title",
            "wrapperSelector": "#edit-field-meta-tags-0-basic-title",
            "editor": null
          },
          "drupal": {
            "component": "field_meta_tags",
            "componentIndex": 0,
            "subfield": null,
            "subfieldIndex": null,
            "property": null,
            "nameTokens": [
              "field_meta_tags",
              "0",
              "basic",
              "title"
            ]
          },
          "note": "Meta title"
        },
        {
          "id": "xlt2uij7fukmfbhs24w",
          "ts": "2025-09-08T19:05:35.696Z",
          "url": "https://live-74999-petcare-purinattt-belgium.pantheonsite.io/nl/node/10630/edit?destination=/fr/admin/content%3Ftitle%3D%26type%3Dnppe_article%26langcode%3DAll%26moderation_state%3DAll",
          "title": "Edit Article De 100 beste namen waarop je kater gek zal zijn - Cloned [Dutch translation] | Purina BE",
          "field": {
            "label": "Beschrijving",
            "type": "textarea:textarea",
            "name": "field_meta_tags[0][basic][description]",
            "id": "edit-field-meta-tags-0-basic-description",
            "dataDrupalSelector": "edit-field-meta-tags-0-basic-description",
            "cssSelector": "#edit-field-meta-tags-0-basic-description",
            "wrapperSelector": "#edit-field-meta-tags-0-basic-description",
            "editor": null
          },
          "drupal": {
            "component": "field_meta_tags",
            "componentIndex": 0,
            "subfield": null,
            "subfieldIndex": null,
            "property": null,
            "nameTokens": [
              "field_meta_tags",
              "0",
              "basic",
              "description"
            ]
          },
          "note": "Meta description"
        },
        {
          "id": "czurbgz2xu4mfbhscwq",
          "ts": "2025-09-08T19:05:49.658Z",
          "url": "https://live-74999-petcare-purinattt-belgium.pantheonsite.io/nl/node/10630/edit?destination=/fr/admin/content%3Ftitle%3D%26type%3Dnppe_article%26langcode%3DAll%26moderation_state%3DAll",
          "title": "Edit Article De 100 beste namen waarop je kater gek zal zijn - Cloned [Dutch translation] | Purina BE",
          "field": {
            "label": "Titel",
            "type": "input:text",
            "name": "field_meta_tags[0][open_graph][og_title]",
            "id": "edit-field-meta-tags-0-open-graph-og-title",
            "dataDrupalSelector": "edit-field-meta-tags-0-open-graph-og-title",
            "cssSelector": "#edit-field-meta-tags-0-open-graph-og-title",
            "wrapperSelector": "#edit-field-meta-tags-0-open-graph-og-title",
            "editor": null
          },
          "drupal": {
            "component": "field_meta_tags",
            "componentIndex": 0,
            "subfield": null,
            "subfieldIndex": null,
            "property": null,
            "nameTokens": [
              "field_meta_tags",
              "0",
              "open_graph",
              "og_title"
            ]
          },
          "note": "OG Title"
        },
        {
          "id": "x1yn3308a5hmfbhsk0x",
          "ts": "2025-09-08T19:05:58.881Z",
          "url": "https://live-74999-petcare-purinattt-belgium.pantheonsite.io/nl/node/10630/edit?destination=/fr/admin/content%3Ftitle%3D%26type%3Dnppe_article%26langcode%3DAll%26moderation_state%3DAll",
          "title": "Edit Article De 100 beste namen waarop je kater gek zal zijn - Cloned [Dutch translation] | Purina BE",
          "field": {
            "label": "Beschrijving",
            "type": "textarea:textarea",
            "name": "field_meta_tags[0][open_graph][og_description]",
            "id": "edit-field-meta-tags-0-open-graph-og-description",
            "dataDrupalSelector": "edit-field-meta-tags-0-open-graph-og-description",
            "cssSelector": "#edit-field-meta-tags-0-open-graph-og-description",
            "wrapperSelector": "#edit-field-meta-tags-0-open-graph-og-description",
            "editor": null
          },
          "drupal": {
            "component": "field_meta_tags",
            "componentIndex": 0,
            "subfield": null,
            "subfieldIndex": null,
            "property": null,
            "nameTokens": [
              "field_meta_tags",
              "0",
              "open_graph",
              "og_description"
            ]
          },
          "note": "OG Description"
        },
        {
          "id": "7kwijg7dnkvmfbhswkg",
          "ts": "2025-09-08T19:06:15.136Z",
          "url": "https://live-74999-petcare-purinattt-belgium.pantheonsite.io/nl/node/10630/edit?destination=/fr/admin/content%3Ftitle%3D%26type%3Dnppe_article%26langcode%3DAll%26moderation_state%3DAll",
          "title": "Edit Article De 100 beste namen waarop je kater gek zal zijn - Cloned [Dutch translation] | Purina BE",
          "field": {
            "label": "URL alias",
            "type": "input:text",
            "name": "path[0][alias]",
            "id": "edit-path-0-alias",
            "dataDrupalSelector": "edit-path-0-alias",
            "cssSelector": "#edit-path-0-alias",
            "wrapperSelector": "#edit-path-0-alias",
            "editor": null
          },
          "drupal": {
            "component": "path",
            "componentIndex": 0,
            "subfield": null,
            "subfieldIndex": null,
            "property": null,
            "nameTokens": [
              "path",
              "0",
              "alias"
            ]
          },
          "note": "URL (path without as example purina.be, if purina.be/xxx/xxx or purina.be/fr/xxx/xxx will receive only /xxx/xxx"
        },
        {
          "id": "88hwbm8rnm4mfedljrr",
          "ts": "2025-09-10T19:31:52.023Z",
          "url": "https://live-74999-petcare-purinattt-belgium.pantheonsite.io/fr/node/10633/edit",
          "title": "Edit Article 7 katvriendelijke snoepjes voor training | Purina BE",
          "field": {
            "label": "Internal title",
            "type": "input:text",
            "name": "field_article_internal_title[0][value]",
            "id": "edit-field-article-internal-title-0-value",
            "dataDrupalSelector": "edit-field-article-internal-title-0-value",
            "cssSelector": "#edit-field-article-internal-title-0-value",
            "wrapperSelector": "#edit-field-article-internal-title-0-value",
            "editor": null
          },
          "drupal": {
            "component": "field_article_internal_title",
            "componentIndex": 0,
            "subfield": null,
            "subfieldIndex": null,
            "property": null,
            "nameTokens": [
              "field_article_internal_title",
              "0",
              "value"
            ]
          },
          "note": "Recebe H1"
        },
        {
          "id": "oxhepgdc8dmfedlqvb",
          "ts": "2025-09-10T19:32:01.223Z",
          "url": "https://live-74999-petcare-purinattt-belgium.pantheonsite.io/fr/node/10633/edit",
          "title": "Edit Article 7 katvriendelijke snoepjes voor training | Purina BE",
          "field": {
            "label": "Titel",
            "type": "input:text",
            "name": "title[0][value]",
            "id": "edit-title-0-value",
            "dataDrupalSelector": "edit-title-0-value",
            "cssSelector": "#edit-title-0-value",
            "wrapperSelector": "#edit-title-0-value",
            "editor": null
          },
          "drupal": {
            "component": "title",
            "componentIndex": 0,
            "subfield": null,
            "subfieldIndex": null,
            "property": null,
            "nameTokens": [
              "title",
              "0",
              "value"
            ]
          },
          "note": "Recebe H1"
        },
        {
          "id": "07pivq3tyjbgmfedlyhj",
          "ts": "2025-09-10T19:32:11.095Z",
          "url": "https://live-74999-petcare-purinattt-belgium.pantheonsite.io/fr/node/10633/edit",
          "title": "Edit Article 7 katvriendelijke snoepjes voor training | Purina BE",
          "field": {
            "label": "Titel",
            "type": "input:text",
            "name": "field_meta_tags[0][open_graph][og_title]",
            "id": "edit-field-meta-tags-0-open-graph-og-title",
            "dataDrupalSelector": "edit-field-meta-tags-0-open-graph-og-title",
            "cssSelector": "#edit-field-meta-tags-0-open-graph-og-title",
            "wrapperSelector": "#edit-field-meta-tags-0-open-graph-og-title",
            "editor": null
          },
          "drupal": {
            "component": "field_meta_tags",
            "componentIndex": 0,
            "subfield": null,
            "subfieldIndex": null,
            "property": null,
            "nameTokens": [
              "field_meta_tags",
              "0",
              "open_graph",
              "og_title"
            ]
          },
          "note": "og title"
        },
        {
          "id": "77i992nznfmfedm300",
          "ts": "2025-09-10T19:32:16.944Z",
          "url": "https://live-74999-petcare-purinattt-belgium.pantheonsite.io/fr/node/10633/edit",
          "title": "Edit Article 7 katvriendelijke snoepjes voor training | Purina BE",
          "field": {
            "label": "Beschrijving",
            "type": "textarea:textarea",
            "name": "field_meta_tags[0][open_graph][og_description]",
            "id": "edit-field-meta-tags-0-open-graph-og-description",
            "dataDrupalSelector": "edit-field-meta-tags-0-open-graph-og-description",
            "cssSelector": "#edit-field-meta-tags-0-open-graph-og-description",
            "wrapperSelector": "#edit-field-meta-tags-0-open-graph-og-description",
            "editor": null
          },
          "drupal": {
            "component": "field_meta_tags",
            "componentIndex": 0,
            "subfield": null,
            "subfieldIndex": null,
            "property": null,
            "nameTokens": [
              "field_meta_tags",
              "0",
              "open_graph",
              "og_description"
            ]
          },
          "note": "og description"
        }
      ]
    }
  };

  // src/utils/helpers.js
  var ensureZip = () => new Promise((resolve, reject) => {
    if (window.JSZip) return resolve();
    const s = document.createElement("script");
    s.src = "https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js";
    s.onload = () => resolve();
    s.onerror = () => reject(new Error("Falha ao carregar JSZip"));
    document.head.appendChild(s);
  });
  var allowed = /* @__PURE__ */ new Set(["DIV", "P", "STRONG", "EM", "UL", "OL", "LI", "A", "H1", "H2", "H3", "H4", "BR"]);
  var sanitizeHTML = (html) => {
    const tmp = document.createElement("div");
    tmp.innerHTML = html || "";
    const sanitizeUrl = (u) => {
      if (!u) return "";
      const url = String(u).trim();
      const low = url.toLowerCase();
      if (low.startsWith("javascript:") || low.startsWith("data:") || low.startsWith("vbscript:")) return "";
      return url;
    };
    const walk = (node) => {
      for (let c = node.firstChild; c; ) {
        const n = c.nextSibling;
        if (c.nodeType === 1) {
          const tag = c.tagName;
          if (!allowed.has(tag)) {
            while (c.firstChild) node.insertBefore(c.firstChild, c);
            node.removeChild(c);
            c = n;
            continue;
          }
          if (tag === "A") {
            let href = c.getAttribute("href");
            href = sanitizeUrl(href);
            if (href) c.setAttribute("href", href);
            else c.removeAttribute("href");
            const allowedTargets = /* @__PURE__ */ new Set(["_blank", "_self", "_parent", "_top"]);
            let target = (c.getAttribute("target") || "").trim().toLowerCase();
            if (!allowedTargets.has(target)) {
              c.removeAttribute("target");
            } else {
              c.setAttribute("target", target);
              if (target === "_blank") {
                const relNow = (c.getAttribute("rel") || "").toLowerCase().split(/\s+/).filter(Boolean);
                if (!relNow.includes("noopener")) relNow.push("noopener");
                if (!relNow.includes("noreferrer")) relNow.push("noreferrer");
                c.setAttribute("rel", Array.from(new Set(relNow)).join(" "));
              }
            }
            [...c.attributes].forEach((a) => {
              const nm = a.name.toLowerCase();
              if (nm !== "href" && nm !== "target" && nm !== "rel") c.removeAttribute(a.name);
            });
          } else {
            [...c.attributes].forEach((a) => c.removeAttribute(a.name));
          }
          walk(c);
        }
        c = n;
      }
    };
    walk(tmp);
    return tmp.innerHTML.replace(/<p>\s*<\/p>/gi, "").replace(/(\s*<br\s*\/?>(\s|&nbsp;)*){2,}/gi, "<br>");
  };
  var esc = (s) => String(s).replace(/[&<>]/g, (m) => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;" })[m]);
  var plainToHTML = (txt) => {
    return txt.trim().split(/\r?\n\r?\n+/).map((p) => `<p>${esc(p).replace(/(https?:\/\/\S+)/g, '<a href="$1">$1</a>')}</p>`).join("");
  };
  var htmlFromClipboardOrText = (input) => /(<p|<h\d|<ul|<ol|<li|<strong|<em|<a|<br)/i.test(input) ? input : plainToHTML(input);
  var sentenceCase = (s) => {
    s = String(s || "").trim();
    if (!s) return s;
    const m = s.match(/^([\(\[\{"'“‘]*)/);
    const lead = m ? m[1] : "";
    let rest = s.slice(lead.length);
    const idx = rest.search(/[A-Za-zÀ-ÖØ-öø-ÿ]/);
    if (idx >= 0) {
      rest = rest.slice(0, idx) + rest.charAt(idx).toUpperCase() + rest.slice(idx + 1);
    }
    let out = lead + rest;
    if (!/[.!?…]$/.test(out)) out += ".";
    return out;
  };
  var dequote = (s) => String(s || "").trim().replace(/^[\s"'“”«»„‚‘’]+|[\s"'“”«»„‚‘’]+$/g, "");
  var cleanUrlAlias = (input) => {
    let s = (input || "").replace(/^[A-Z]{2}:\s*/, "").trim();
    s = s.replace(/^https?:\/\/[^/]+/, "");
    s = s.replace(/^\/(nl|fr|en)(?=\/)/i, "");
    s = s.replace(/\s*-\s*/g, "-");
    s = s.replace(/\s+/g, "");
    if (s && s[0] !== "/") s = "/" + s;
    return s;
  };
  var getParagraphs = (root) => [...root.querySelectorAll("p,h1,h2,h3,h4,ul,ol")];
  var getText = (el) => (el.textContent || "").replace(/\u00a0/g, " ").trim();
  var pullLabeled = (blocks, labelRegex) => {
    for (let i = 0; i < blocks.length; i++) {
      const t = getText(blocks[i]), m = t.match(labelRegex);
      if (m) {
        const after = t.replace(labelRegex, "").trim();
        if (after) return after;
        const next = blocks[i + 1] && blocks[i + 1].tagName === "P" ? getText(blocks[i + 1]) : "";
        return next || "";
      }
    }
    return "";
  };

  // src/parsers/markdown.js
  var markdownToHTML = (md) => {
    if (!md || !md.trim()) return "";
    const escHtml = (s) => s.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
    md = md.replace(/•\s*/g, "\n- ").replace(/\r\n?/g, "\n");
    const lines = md.split("\n");
    let out = [];
    let buf = [];
    let listMode = null;
    const flushPara = () => {
      if (!buf.length) return;
      const text = buf.join(" ").trim();
      if (text) out.push(`<p>${text}</p>`);
      buf = [];
    };
    const flushList = () => {
      if (!listMode) return;
      out.push(`</${listMode}>`);
      listMode = null;
    };
    const emitListItem = (html2, isOrdered) => {
      if (!listMode) {
        listMode = isOrdered ? "ol" : "ul";
        out.push(`<${listMode}>`);
      } else if (isOrdered && listMode !== "ol" || !isOrdered && listMode !== "ul") {
        flushList();
        listMode = isOrdered ? "ol" : "ul";
        out.push(`<${listMode}>`);
      }
      out.push(`<li>${html2}</li>`);
    };
    const inline = (s) => {
      s = s.replace(
        /\(([^)]+)\)\s*\[\s*(https?:\/\/[^\]\s]+)\s*\]/g,
        (m, t, u) => `<a href="${u}">${esc(t)}</a>`
      );
      s = s.replace(/\[([^\]]+)\]\(\s*(https?:\/\/[^\s)]+)\s*\)/g, (m, t, u) => `<a href="${u}">${esc(t)}</a>`);
      s = s.replace(/\[([^\]]+)\]\s*[:：]\s*(https?:\/\/\S+)/g, (m, t, u) => `<a href="${u}">${esc(t)}</a>`);
      s = s.replace(
        /((?:<strong>[^<]+<\/strong>|<em>[^<]+<\/em>|[^\s<][^<\s]*))\s*\[\s*(https?:\/\/[^\]\s]+)\s*\]/g,
        (m, txt, u) => `<a href="${u}">${txt}</a>`
      );
      s = s.replace(/\[(https?:\/\/[^\s\]]+)\]/g, (m, u) => `<a href="${u}">${u}</a>`);
      s = s.replace(/(\*\*|__)(.+?)\1/g, "<strong>$2</strong>");
      s = s.replace(/(^|[^\*])\*(?!\s)(.+?)(?<!\s)\*(?!\*)/g, "$1<em>$2</em>");
      s = s.replace(/(^|[^_])_(?!\s)(.+?)(?<!\s)_(?!_)/g, "$1<em>$2</em>");
      return s;
    };
    for (let i = 0; i < lines.length; i++) {
      let line = lines[i];
      if (/^\s*```/.test(line)) {
        continue;
      }
      let m;
      if (m = line.match(/^\s*#{3}\s+(.+)$/)) {
        flushPara();
        flushList();
        out.push(`<h3>${inline(escHtml(m[1].trim()))}</h3>`);
        continue;
      }
      if (m = line.match(/^\s*#{2}\s+(.+)$/)) {
        flushPara();
        flushList();
        out.push(`<h2>${inline(escHtml(m[1].trim()))}</h2>`);
        continue;
      }
      if (m = line.match(/^\s*#\s+(.+)$/)) {
        flushPara();
        flushList();
        out.push(`<h1>${inline(escHtml(m[1].trim()))}</h1>`);
        continue;
      }
      if (m = line.match(/^\s*(\d+)[.)]\s+(.+)$/)) {
        flushPara();
        emitListItem(inline(escHtml(sentenceCase(m[2].trim()))), true);
        continue;
      }
      if (m = line.match(/^\s*[-*+]\s+(.+)$/)) {
        flushPara();
        emitListItem(inline(escHtml(sentenceCase(m[1].trim()))), false);
        continue;
      }
      if (!line.trim()) {
        flushPara();
        flushList();
        continue;
      }
      buf.push(inline(escHtml(line.trim())));
    }
    flushPara();
    flushList();
    const html = out.join("\n").replace(/ {2}\n/g, "<br>\n");
    return sanitizeHTML(html);
  };

  // src/parsers/docx.js
  var getDocxHTML = async (file) => {
    await ensureZip();
    const z = await JSZip.loadAsync(await file.arrayBuffer());
    const docXml = await z.file("word/document.xml")?.async("string");
    const relsXml = await z.file("word/_rels/document.xml.rels")?.async("string") || "";
    const numXml = await z.file("word/numbering.xml")?.async("string") || "";
    if (!docXml) throw new Error("Documento Word inv\xE1lido");
    const parse = (s) => new DOMParser().parseFromString(s, "application/xml");
    const W_NS = "http://schemas.openxmlformats.org/wordprocessingml/2006/main";
    const R_NS = "http://schemas.openxmlformats.org/officeDocument/2006/relationships";
    const A_NS = "http://schemas.openxmlformats.org/drawingml/2006/main";
    const doc = parse(docXml);
    const rels = relsXml ? parse(relsXml) : null;
    const num = numXml ? parse(numXml) : null;
    const relMap = {};
    if (rels) Array.from(rels.getElementsByTagName("Relationship")).forEach((r) => {
      const id = r.getAttribute("Id");
      const t = r.getAttribute("Target");
      if (id && t) relMap[id] = t;
    });
    const numIdToAbs = {};
    const absLvlToFmt = {};
    if (num) {
      Array.from(num.getElementsByTagNameNS(W_NS, "num")).forEach((n) => {
        const numId = n.getAttributeNS(W_NS, "numId");
        const absEl = n.getElementsByTagNameNS(W_NS, "abstractNumId")[0];
        const absId = absEl?.getAttributeNS(W_NS, "val");
        if (numId && absId) numIdToAbs[numId] = absId;
      });
      Array.from(num.getElementsByTagNameNS(W_NS, "abstractNum")).forEach((a) => {
        const absId = a.getAttributeNS(W_NS, "abstractNumId");
        Array.from(a.getElementsByTagNameNS(W_NS, "lvl")).forEach((lvl) => {
          const ilvl = lvl.getAttributeNS(W_NS, "ilvl") || "0";
          const fmt = lvl.getElementsByTagNameNS(W_NS, "numFmt")[0]?.getAttributeNS(W_NS, "val") || "bullet";
          absLvlToFmt[`${absId}:${ilvl}`] = fmt;
        });
      });
    }
    const listInfo = (p) => {
      const numPr = p.getElementsByTagNameNS(W_NS, "numPr")[0];
      if (!numPr) return null;
      const numIdEl = numPr.getElementsByTagNameNS(W_NS, "numId")[0];
      if (!numIdEl) return null;
      const ilvlEl = numPr.getElementsByTagNameNS(W_NS, "ilvl")[0];
      const numId = numIdEl.getAttributeNS(W_NS, "val");
      const ilvl = ilvlEl?.getAttributeNS(W_NS, "val") || "0";
      const absId = numIdToAbs[numId];
      const fmt = absLvlToFmt[`${absId}:${ilvl}`] || "bullet";
      const type = /decimal|lowerRoman|upperRoman|lowerLetter|upperLetter/i.test(fmt) ? "ol" : "ul";
      return { type, level: parseInt(ilvl, 10) || 0 };
    };
    const headingTag = (p) => {
      const ps2 = p.getElementsByTagNameNS(W_NS, "pStyle")[0];
      const v = ps2?.getAttributeNS(W_NS, "val") || "";
      const m = v.match(/Heading([1-6])/i);
      if (m) {
        const lvl = parseInt(m[1], 10);
        if (lvl === 1) return "h1";
        if (lvl === 2) return "h2";
        if (lvl === 3) return "h3";
        return "h4";
      }
      const pPr = p.getElementsByTagNameNS(W_NS, "pPr")[0];
      const rPr = pPr?.getElementsByTagNameNS(W_NS, "rPr")[0];
      const sz = rPr?.getElementsByTagNameNS(W_NS, "sz")[0];
      if (sz) {
        const val = parseInt(sz.getAttributeNS(W_NS, "val"), 10);
        if (val >= 48) return "h2";
        if (val >= 36) return "h3";
      }
      return null;
    };
    const smartJoin = (acc, piece) => {
      if (!acc) return piece;
      const a = acc.slice(-1), b = piece[0];
      if (a && b && !/[\s>]/.test(a) && !/[\s,.;:!?)]/.test(b)) return acc + " " + piece;
      return acc + piece;
    };
    const textFromRun = async (r) => {
      const rPr = r.getElementsByTagNameNS(W_NS, "rPr")[0];
      const isB = !!rPr?.getElementsByTagNameNS(W_NS, "b")[0];
      const isI = !!rPr?.getElementsByTagNameNS(W_NS, "i")[0];
      let out = "";
      for (const n of Array.from(r.childNodes)) {
        if (n.namespaceURI !== W_NS) continue;
        switch (n.localName) {
          case "t":
            out = smartJoin(out, esc(n.textContent || ""));
            break;
          case "tab":
            out = smartJoin(out, " ");
            break;
          case "softHyphen":
            out += "\xAD";
            break;
          case "br":
            out += "<br>";
            break;
          case "drawing": {
            const blip = n.getElementsByTagNameNS(A_NS, "blip")[0];
            const embedId = blip?.getAttributeNS(R_NS, "embed");
            if (embedId && relMap[embedId]) {
              const imgPath = "word/" + relMap[embedId];
              try {
                const imgData = await z.file(imgPath)?.async("base64");
                if (imgData) {
                  const ext = imgPath.split(".").pop().toLowerCase();
                  const mime = ext === "png" ? "image/png" : ext === "jpeg" || ext === "jpg" ? "image/jpeg" : "image/gif";
                  out += `<img src="data:${mime};base64,${imgData}" alt="Image">`;
                }
              } catch (e) {
                console.warn("Failed to load image:", imgPath, e);
              }
            }
            break;
          }
          default:
            break;
        }
      }
      if (!out) return "";
      if (isB) out = `<strong>${out}</strong>`;
      if (isI) out = `<em>${out}</em>`;
      return out;
    };
    const renderInline = async (container) => {
      let acc = "";
      for (const n of Array.from(container.childNodes)) {
        if (n.namespaceURI !== W_NS) continue;
        if (n.localName === "r") acc = smartJoin(acc, await textFromRun(n));
        else if (n.localName === "hyperlink") {
          const rid = n.getAttributeNS(R_NS, "id") || n.getAttribute("r:id");
          const url = rid ? relMap[rid] || "#" : "#";
          const inner = await renderInline(n);
          acc = smartJoin(acc, `<a href="${esc(url)}">${inner}</a>`);
        } else if (n.localName === "br") acc += "<br>";
        else if (n.localName === "tab") acc = smartJoin(acc, " ");
        else if (n.localName === "softHyphen") acc += "\xAD";
      }
      return acc.trim();
    };
    let html = "";
    const ps = Array.from(doc.getElementsByTagNameNS(W_NS, "p"));
    const listStack = [];
    const closeListsTo = (targetLevel) => {
      while (listStack.length - 1 > targetLevel) {
        const last = listStack.pop();
        html += `</${last.type}>`;
      }
    };
    for (const p of ps) {
      const content = await renderInline(p);
      if (!content && !p.getElementsByTagNameNS(W_NS, "drawing").length) continue;
      const h = headingTag(p);
      const li = listInfo(p);
      if (li) {
        if (listStack.length === 0) {
          html += `<${li.type}>`;
          listStack.push({ type: li.type });
        } else {
          const curLevel = listStack.length - 1;
          if (li.level > curLevel) {
            html += `<${li.type}>`;
            listStack.push({ type: li.type });
          } else if (li.level < curLevel) {
            closeListsTo(li.level);
          }
          const curType = listStack[listStack.length - 1].type;
          if (curType !== li.type) {
            html += `</${curType}><${li.type}>`;
            listStack[listStack.length - 1].type = li.type;
          }
        }
        html += `<li>${content}</li>`;
        continue;
      }
      closeListsTo(-1);
      while (listStack.length) {
        html += `</${listStack.pop().type}>`;
      }
      if (h) html += `<${h}>${content}</${h}>`;
      else html += `<p>${content}</p>`;
    }
    closeListsTo(-1);
    while (listStack.length) {
      html += `</${listStack.pop().type}>`;
    }
    return sanitizeHTML(html);
  };

  // src/parsers/format-detector.js
  var COMPONENT_TYPE_MAPPING = {
    "Text Block 1": "c_text",
    "Text Block 2": "c_text",
    "Text Block 3": "c_text",
    "Image+Text 1": "c_sideimagetext",
    "Image+Text 2": "c_sideimagetext",
    "Image+Text 3": "c_sideimagetext",
    "Contact Us Small": "c_signposting",
    "Image Gallery": "c_media",
    "Product Recommendations": "c_products_list",
    "Tabbed Content": "c_tabbed_content",
    "Accordion": "c_accordion",
    "Brand Carousel": "c_brand_carousel",
    "Document": "c_document"
  };
  var detectDocxFormat = (html) => {
    const hasStandardMarkers = /(?:URL\s*:|H1\s*:|Intro\s*\(H3\)|Text\s*block)/i.test(html);
    const hasTemplateMarkers = /(?:Source\s*:|Article\s*category\s*:|\[COMPONENT\s*:)/i.test(html);
    const hasHeadings = /<h1/i.test(html) && !/Text\s*block/i.test(html);
    if (hasTemplateMarkers || hasHeadings) {
      console.log("[v1-Phase2] Formato detectado: template (ou heading-based)");
      return "template";
    }
    if (hasStandardMarkers) {
      console.log("[v1-Phase2] Formato detectado: standard");
      return "standard";
    }
    console.log("[v1-Phase2] Formato detectado: unknown (usando standard como fallback)");
    return "unknown";
  };
  var extractComponents = (html) => {
    const components = [];
    const componentRegex = /\[COMPONENT:\s*([^\]]+)\]/gi;
    const matches = [...html.matchAll(componentRegex)];
    if (matches.length === 0) return null;
    matches.forEach((match, index) => {
      const type = match[1].trim();
      const startIndex = match.index + match[0].length;
      const nextMatch = matches[index + 1];
      const endIndex = nextMatch ? nextMatch.index : html.length;
      const rawContent = html.substring(startIndex, endIndex);
      const tmp = document.createElement("div");
      tmp.innerHTML = rawContent;
      const blocks = [...tmp.querySelectorAll("p,h1,h2,h3,h4,ul,ol")].filter((el) => {
        const text = (el.textContent || "").trim();
        return text && !text.match(/^(Source|Article category|Meta|SEO METADATA|URL\s*:|\[COMPONENT)/i);
      });
      const content = blocks.map((b) => b.outerHTML).join("");
      const drupalType = COMPONENT_TYPE_MAPPING[type] || "c_text";
      if (drupalType === "c_text" && !COMPONENT_TYPE_MAPPING[type]) {
        console.warn(`[v1-Phase2] Componente n\xE3o mapeado: "${type}", usando c_text como fallback`);
      }
      components.push({
        type,
        content,
        rawHtml: rawContent,
        drupalType
      });
    });
    console.log(`[v1-Phase2] ${components.length} componente(s) extra\xEDdo(s)`);
    return components.length > 0 ? components : null;
  };
  var extractComponentsFromStructure = (html) => {
    const tmp = document.createElement("div");
    tmp.innerHTML = html;
    const components = [];
    let current = null;
    const flush = () => {
      if (current) {
        components.push(current);
        current = null;
      }
    };
    const nodes = Array.from(tmp.childNodes);
    let introContent = "";
    let inIntro = true;
    for (let i = 0; i < nodes.length; i++) {
      const node = nodes[i];
      if (node.nodeType !== 1) continue;
      const tag = node.tagName;
      const text = node.textContent.trim();
      const hasImg = node.querySelector("img") || tag === "IMG";
      if (/^H[23]$/.test(tag)) {
        flush();
        inIntro = false;
        let sibling = node.nextElementSibling;
        const nextHasImg = sibling && (sibling.querySelector("img") || sibling.tagName === "IMG");
        if (nextHasImg) {
          current = { type: "c_sideimagetext", content: node.outerHTML, index: components.length, drupalType: "c_sideimagetext", label: text.substring(0, 30) };
        } else {
          current = { type: "c_text", content: node.outerHTML, index: components.length, drupalType: "c_text", label: text.substring(0, 30) };
        }
        continue;
      }
      if (hasImg) {
        inIntro = false;
        if (!current) {
          current = { type: "c_sideimagetext", content: "", index: components.length, drupalType: "c_sideimagetext", label: "Image Block" };
        }
        current.content += node.outerHTML;
        continue;
      }
      if (inIntro) {
        if (tag === "H1" || /^(Meta|OG|URL|Source)/i.test(text)) {
        } else {
          introContent += node.outerHTML;
        }
      } else {
        if (!current) {
          current = { type: "c_text", content: "", index: components.length, drupalType: "c_text", label: "Text Block" };
        }
        current.content += node.outerHTML;
      }
    }
    flush();
    return { components, intro: introContent };
  };
  var parseTemplateFormat = (html) => {
    const clean = sanitizeHTML(htmlFromClipboardOrText(html));
    const tmp = document.createElement("div");
    tmp.innerHTML = clean;
    const h1Tag = tmp.querySelector("h1");
    let h1 = h1Tag ? getText(h1Tag) : "";
    if (h1 && !h1.match(/^(Source|Article category|Meta|SEO)/i)) {
      h1 = dequote(h1).substring(0, 255);
    }
    const blocks = getParagraphs(tmp);
    let urlAlias = "";
    for (const block of blocks) {
      const text = getText(block);
      const sourceMatch = text.match(/^Source\s*:\s*(.+)$/i);
      if (sourceMatch) {
        urlAlias = cleanUrlAlias(sourceMatch[1].trim());
        break;
      }
    }
    const allText = tmp.textContent || "";
    const seoSectionMatch = allText.match(/SEO\s+METADATA([\s\S]*?)(?:\[COMPONENT\s*:|$)/i);
    let metaTitle = "", metaDesc = "";
    if (seoSectionMatch) {
      const seoContent = seoSectionMatch[1];
      const metaTitleMatch = seoContent.match(/Meta\s*title\s*:\s*([^\n]+)/i);
      const metaDescMatch = seoContent.match(/Meta\s*description\s*:\s*([^\n]+)/i);
      metaTitle = metaTitleMatch ? dequote(metaTitleMatch[1].trim()) : "";
      metaDesc = metaDescMatch ? dequote(metaDescMatch[1].trim()) : "";
    }
    const ogTitle = metaTitle;
    const ogDesc = metaDesc;
    let components = extractComponents(clean);
    let intro = "";
    if (!components) {
      console.log("[v1-Phase2] No [COMPONENT] markers found. Trying structure-based extraction.");
      const struct = extractComponentsFromStructure(clean);
      components = struct.components;
      intro = struct.intro;
    } else {
      let foundH1 = false;
      for (const block of blocks) {
        if (block.tagName === "H1") {
          foundH1 = true;
          continue;
        }
        if (foundH1 && block.tagName === "P") {
          const text = (block.textContent || "").trim();
          if (text && !text.match(/^(Source|Article category|SEO METADATA|\[COMPONENT)/i)) {
            intro = `<h3>${block.innerHTML}</h3>`;
            break;
          }
        }
      }
    }
    let t1 = "", t2 = "", t3 = "";
    if (!components || components.length === 0) {
      const contentBlocks = blocks.filter((b) => {
        const text = (b.textContent || "").trim();
        return text && !text.match(/^(Source|Article category|Meta|SEO METADATA|URL\s*:)/i);
      });
      t1 = contentBlocks.map((b) => b.outerHTML).join("");
    }
    return {
      clean,
      h1,
      intro,
      t1,
      t2,
      t3,
      imgBlocks: [],
      metaTitle,
      metaDesc,
      ogTitle,
      ogDesc,
      urlAlias,
      components: components || [],
      category: null
    };
  };
  var parseStandardFormat = (html) => {
    const clean = sanitizeHTML(htmlFromClipboardOrText(html));
    const tmp = document.createElement("div");
    tmp.innerHTML = clean;
    const blocks = getParagraphs(tmp).filter((n) => {
      const s = getText(n);
      if (/^Add a block with the following info here/i.test(s)) return false;
      if (/^(Voor meer informação|Voor meer informatie|En savoir plus)$/i.test(s)) return false;
      return true;
    });
    const h1Tag = tmp.querySelector("h1");
    let h1 = h1Tag ? getText(h1Tag) : "";
    if (!h1) h1 = pullLabeled(blocks, /^\s*H1\s*:?\s*/i);
    const metaTitle = pullLabeled(blocks, /^Meta\s*title\s*:\s*/i);
    const metaDesc = pullLabeled(blocks, /^Meta\s*description\s*:\s*/i);
    const ogTitle = pullLabeled(blocks, /^(OG|Og)\s*title\s*:\s*/i);
    const ogDesc = pullLabeled(blocks, /^(OG|Og)\s*description\s*:\s*/i);
    const urlFull = pullLabeled(blocks, /^URL\s*:\s*/i);
    const urlAlias = urlFull ? cleanUrlAlias(urlFull) : "";
    h1 = dequote(h1);
    const _metaTitle = dequote(metaTitle);
    const _metaDesc = dequote(metaDesc);
    let _ogTitle = dequote(ogTitle) || _metaTitle;
    let _ogDesc = dequote(ogDesc) || _metaDesc;
    const _urlAlias = urlAlias || "";
    const htmlBlocks = blocks.map((n) => n.outerHTML);
    const texts = [], alts = [];
    for (let i = 0; i < htmlBlocks.length; i++) {
      const plain = htmlBlocks[i].replace(/<[^>]+>/g, "").trim();
      const m = plain.match(/^Alt-tag\s*:\s*(.+)$/i);
      if (m) {
        const summary = [];
        for (let j = i + 1; j < htmlBlocks.length && summary.length < 4; j++) {
          const s = htmlBlocks[j].replace(/<[^>]+>/g, "").trim();
          if (!s || /^Alt-tag\s*:/i.test(s) || /^Meta |^(OG|Og)\s+/i.test(s) || /^URL\s*:/i.test(s)) break;
          summary.push(htmlBlocks[j]);
          if (summary.join("").replace(/<[^>]+>/g, "").length >= 480) break;
        }
        alts.push({ alt: m[1].trim(), summary: summary.slice(0, 2).join("") });
      } else texts.push(htmlBlocks[i]);
    }
    const intro = texts.length ? `<h3>${texts[0].replace(/^<p>|<\/p>$/g, "")}</h3>` : "";
    const rest = texts.slice(1);
    const parts = (arr, n) => arr.length ? Array.from({ length: n }, (_, k) => arr.slice(Math.ceil(arr.length / n) * k, Math.ceil(arr.length / n) * (k + 1)).join("")) : Array(n).fill("");
    const [t1, t2, t3] = parts(rest, 3);
    return { clean, h1, intro, t1, t2, t3, imgBlocks: alts.slice(0, 2), metaTitle: _metaTitle, metaDesc: _metaDesc, ogTitle: _ogTitle, ogDesc: _ogDesc, urlAlias: _urlAlias };
  };
  var parseArticle = (html) => {
    const format = detectDocxFormat(html);
    if (format === "template") {
      return parseTemplateFormat(html);
    } else {
      return parseStandardFormat(html);
    }
  };

  // src/drupal/adapter.js
  var getAddMoreButtonId = (drupalType) => {
    const typeMapping = {
      "c_text": "c-text",
      "c_sideimagetext": "c-sideimagetext-ttt",
      "c_signposting": "c-signposting",
      "c_media": "c-media",
      "c_products_list": "c-products-list",
      "c_tabbed_content": "c-tabbed-content",
      "c_accordion": "accordion",
      "c_brand_carousel": "c-brand-carousel",
      "c_document": "c-document"
    };
    const mappedType = typeMapping[drupalType] || drupalType;
    const selector = `input[id^="field-article-lp-components-${mappedType}-add-more"]`;
    const button = document.querySelector(selector);
    if (button) return button.id;
    return null;
  };
  var componentExists = (index) => {
    const wrapper = document.getElementById(`field-article-lp-components-${index}-item-wrapper`);
    return wrapper !== null;
  };
  var waitForAjax = async (timeout = 15e3) => {
    const start = Date.now();
    await new Promise((resolve) => setTimeout(resolve, 200));
    while (Date.now() - start < timeout) {
      if (window.jQuery) {
        if (window.jQuery.active === 0) {
          await new Promise((resolve) => setTimeout(resolve, 100));
          if (window.jQuery.active === 0) return true;
        }
      } else {
        const ajaxActive = document.querySelector(".ajax-progress") !== null;
        if (!ajaxActive) return true;
      }
      await new Promise((resolve) => setTimeout(resolve, 100));
    }
    return false;
  };
  var createDrupalComponents = async (components, logs) => {
    if (!components || components.length === 0) {
      logs.push("[v1-Phase2] Nenhum componente para criar");
      return [];
    }
    const processedComponents = [];
    for (let i = 0; i < components.length; i++) {
      const component = components[i];
      const { drupalType, type } = component;
      const targetIndex = i;
      if (componentExists(targetIndex)) {
        logs.push(`\u2139\uFE0F Componente ${i} (${type}) j\xE1 existe. Pulando cria\xE7\xE3o.`);
        processedComponents.push({ ...component, index: targetIndex });
        continue;
      }
      logs.push(`[v1-Phase2] Componente ${i} ausente. Criando...`);
      const buttonId = getAddMoreButtonId(drupalType);
      if (!buttonId) {
        logs.push(`\u274C Bot\xE3o "Add more" n\xE3o encontrado para ${drupalType}`);
        continue;
      }
      const button = document.getElementById(buttonId);
      if (!button) {
        logs.push(`\u274C Bot\xE3o n\xE3o encontrado: ${buttonId}`);
        continue;
      }
      const dropWrapper = button.closest(".dropbutton-wrapper");
      if (dropWrapper) {
        const toggle = dropWrapper.querySelector(".dropbutton-toggle button");
        if (toggle && toggle.offsetParent !== null) {
          toggle.click();
          await new Promise((r) => setTimeout(r, 600));
        }
      }
      logs.push(`\u{1F504} Adicionando componente ${i + 1}/${components.length}: ${type} (${drupalType})`);
      try {
        button.scrollIntoView({ block: "center", inline: "center" });
        button.focus();
        button.dispatchEvent(new MouseEvent("mousedown", { bubbles: true, cancelable: true, view: window }));
        button.dispatchEvent(new MouseEvent("mouseup", { bubbles: true, cancelable: true, view: window }));
        button.click();
      } catch (e) {
        logs.push(`\u26A0\uFE0F Erro ao clicar: ${e.message}`);
        button.click();
      }
      const ajaxSuccess = await waitForAjax(15e3);
      if (!ajaxSuccess) {
        logs.push(`\u26A0\uFE0F AJAX timeout para componente ${type}`);
        continue;
      }
      if (componentExists(targetIndex)) {
        logs.push(`\u2705 Componente ${i} criado com sucesso`);
        processedComponents.push({ ...component, index: targetIndex });
      } else {
        logs.push(`\u26A0\uFE0F Novo componente ${i} n\xE3o detectado ap\xF3s AJAX`);
      }
      await new Promise((r) => setTimeout(r, 500));
    }
    return processedComponents;
  };
  var getCKE5Registry = () => {
    if (window.Drupal?.CKEditor5Instances) return window.Drupal.CKEditor5Instances;
    return null;
  };
  var findCKInstance = (selector) => {
    const registry = getCKE5Registry();
    if (!registry) return null;
    if (registry.has(selector)) return registry.get(selector);
    const el = document.querySelector(selector);
    if (el) {
      for (const [key, instance] of registry) {
        if (instance.sourceElement === el) return instance;
      }
    }
    return null;
  };
  var setRichText = async (selector, html, logs) => {
    const instance = findCKInstance(selector);
    if (instance) {
      instance.setData(html);
      logs.push(`\u2705 CKEditor definido para ${selector}`);
    } else {
      const el = document.querySelector(selector);
      if (el) {
        el.value = html;
        el.dispatchEvent(new Event("input", { bubbles: true }));
        el.dispatchEvent(new Event("change", { bubbles: true }));
        logs.push(`\u2705 Valor definido (fallback) para ${selector}`);
      } else {
        logs.push(`\u274C Campo n\xE3o encontrado: ${selector}`);
      }
    }
  };
  var setInput = (selector, val, logs) => {
    const el = document.querySelector(selector);
    if (el) {
      el.value = val || "";
      el.dispatchEvent(new Event("input", { bubbles: true }));
      el.dispatchEvent(new Event("change", { bubbles: true }));
      logs.push(`\u2705 Input definido para ${selector}`);
    } else {
      logs.push(`\u274C Input n\xE3o encontrado: ${selector}`);
    }
  };
  var fillComponentContent = async (componentIndex, content, logs) => {
    if (!content || content.trim() === "") {
      logs.push(`[v1-Phase2] Componente ${componentIndex}: conte\xFAdo vazio, pulando`);
      return false;
    }
    const possibleSelectors = [
      `#field-article-lp-components-${componentIndex}-subform-field-text-0-value`,
      `#field-article-lp-components-${componentIndex}-subform-field-content-0-value`,
      `#field-article-lp-components-${componentIndex}-subform-field-body-0-value`
    ];
    for (const selector of possibleSelectors) {
      const field = document.querySelector(selector);
      if (field) {
        await setRichText(selector, content, logs);
        return true;
      }
    }
    logs.push(`\u26A0\uFE0F Campo de texto n\xE3o encontrado no componente ${componentIndex}`);
    return false;
  };
  var mapStandardToComponents = (intro, t1, t2, t3, i1, i2) => {
    const components = [];
    if (intro?.trim()) components.push({ index: 0, type: "c_text", content: intro, label: "Intro" });
    if (t1?.trim()) components.push({ index: 1, type: "c_text", content: t1, label: "Text Block 1" });
    if (i1?.trim()) components.push({ index: 2, type: "c_sideimagetext", content: i1, label: "Image+Text 1" });
    if (t2?.trim()) components.push({ index: 3, type: "c_text", content: t2, label: "Text Block 2" });
    if (i2?.trim()) components.push({ index: 4, type: "c_sideimagetext", content: i2, label: "Image+Text 2" });
    if (t3?.trim()) components.push({ index: 5, type: "c_text", content: t3, label: "Text Block 3" });
    return components;
  };
  var createMissingComponents = async (neededComponents, logs) => {
    const missing = neededComponents.filter((comp) => !componentExists(comp.index));
    if (missing.length === 0) {
      logs.push("[v1-Phase2.5] Todos os componentes j\xE1 existem \u2705");
      return true;
    }
    logs.push("");
    logs.push(`[v1-Phase2.5] \u{1F527} Criando ${missing.length} componente(s) faltante(s)...`);
    for (const comp of missing) {
      const buttonId = getAddMoreButtonId(comp.type);
      if (!buttonId) {
        logs.push(`\u274C Bot\xE3o n\xE3o encontrado para ${comp.type}`);
        continue;
      }
      const button = document.getElementById(buttonId);
      if (!button) {
        logs.push(`\u274C Bot\xE3o ${buttonId} n\xE3o existe`);
        continue;
      }
      const dropWrapper = button.closest(".dropbutton-wrapper");
      if (dropWrapper) {
        const toggle = dropWrapper.querySelector(".dropbutton-toggle button");
        if (toggle && toggle.offsetParent !== null) {
          toggle.click();
          await new Promise((r) => setTimeout(r, 600));
        }
      }
      logs.push(`\u{1F504} Criando ${comp.label} (index ${comp.index}, tipo ${comp.type})...`);
      try {
        button.scrollIntoView({ block: "center", inline: "center" });
        button.focus();
        button.dispatchEvent(new MouseEvent("mousedown", { bubbles: true, cancelable: true, view: window }));
        button.dispatchEvent(new MouseEvent("mouseup", { bubbles: true, cancelable: true, view: window }));
        button.click();
      } catch (e) {
        logs.push(`\u26A0\uFE0F Erro ao clicar: ${e.message}`);
        button.click();
      }
      const ajaxOk = await waitForAjax(15e3);
      if (!ajaxOk) {
        logs.push(`\u26A0\uFE0F AJAX timeout para ${comp.label}`);
        continue;
      }
      if (componentExists(comp.index)) {
        logs.push(`\u2705 ${comp.label} criado com sucesso`);
      } else {
        logs.push(`\u26A0\uFE0F ${comp.label} n\xE3o detectado ap\xF3s AJAX`);
      }
      await new Promise((r) => setTimeout(r, 500));
    }
    return true;
  };
  var fillDrupal = async (meta, { $intro, $t1, $t2, $t3, $i1, $i2 }) => {
    const logs = [];
    logs.push("Iniciando preenchimento...");
    if (meta.h1) {
      await setInput('input[name="title[0][value]"]', meta.h1, logs);
      await setInput('input[name="field_article_internal_title[0][value]"]', meta.h1, logs);
    }
    if (meta.metaTitle) await setInput('input[name="field_meta_tags[0][basic][title]"]', meta.metaTitle, logs);
    if (meta.metaDesc) await setInput('textarea[name="field_meta_tags[0][basic][description]"]', meta.metaDesc, logs);
    if (meta.ogTitle) await setInput('input[name="field_meta_tags[0][open_graph][og_title]"]', meta.ogTitle, logs);
    if (meta.ogDesc) await setInput('textarea[name="field_meta_tags[0][open_graph][og_description]"]', meta.ogDesc, logs);
    if (meta.urlAlias) await setInput('input[name="path[0][alias]"]', meta.urlAlias, logs);
    if (meta.components && meta.components.length > 0) {
      logs.push(`[v1-Phase2] Usando ${meta.components.length} componentes estruturados`);
      const created = await createDrupalComponents(meta.components, logs);
      for (const comp of created) {
        await fillComponentContent(comp.index, comp.content, logs);
      }
    } else {
      logs.push("[v1-Phase2] Usando l\xF3gica padr\xE3o (Intro, T1, I1...)");
      const intro = $intro.innerHTML;
      const t1 = $t1.innerHTML;
      const t2 = $t2.innerHTML;
      const t3 = $t3.innerHTML;
      const i1 = $i1.innerHTML;
      const i2 = $i2.innerHTML;
      const needed = mapStandardToComponents(intro, t1, t2, t3, i1, i2);
      await createMissingComponents(needed, logs);
      if (intro.trim()) await fillComponentContent(0, intro, logs);
      if (t1.trim()) await fillComponentContent(1, t1, logs);
      if (i1.trim()) await fillComponentContent(2, i1, logs);
      if (t2.trim()) await fillComponentContent(3, t2, logs);
      if (i2.trim()) await fillComponentContent(4, i2, logs);
      if (t3.trim()) await fillComponentContent(5, t3, logs);
    }
    return logs.join("\n");
  };

  // src/ui/panel.js
  var createPanel = () => {
    const ID = "nppe-paste-fill";
    document.getElementById(ID)?.remove();
    document.getElementById(ID + "-style")?.remove();
    const css = `
  #${ID}{position:fixed;inset:0;z-index:2147483647;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center}
  #${ID} .box{width:min(1200px,96vw);max-height:94vh;background:#0f1115;color:#eaeef3;border-radius:14px;box-shadow:0 12px 40px rgba(0,0,0,.6);display:flex;flex-direction:column}
  #${ID} .hd{display:flex;align-items:center;gap:12px;padding:14px 16px;border-bottom:1px solid #23262d}
  #${ID} .hd h3{margin:0;font:600 16px/1.3 system-ui}
  #${ID} .bd{display:grid;grid-template-columns:340px 1fr;gap:12px;padding:12px 16px;overflow:auto}
  #${ID} .col{display:flex;flex-direction:column;gap:10px}
  #${ID} textarea{width:100%;min-height:160px;background:#12151c;color:#eaeef3;border:1px solid #2a2f3a;border-radius:10px;padding:10px 12px;font:13px/1.5 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}
  #${ID} select{width:100%;background:#12151c;color:#eaeef3;border:1px solid #2a2f3a;border-radius:10px;padding:10px 12px;font:13px/1.5 system-ui}
  #${ID} input[type="file"]{width:100%}
  #${ID} .btns{display:flex;gap:8px;padding:12px 16px;border-top:1px solid #23262d;justify-content:flex-end}
  #${ID} button{background:#2a6df5;border:none;color:#fff;border-radius:10px;padding:9px 12px;font:600 13px/1 system-ui;cursor:pointer}
  #${ID} button.secondary{background:#1f2430}
  #${ID} .log{white-space:pre-wrap;background:#0b0d12;border:1px solid #23262d;border-radius:10px;padding:10px;min-height:120px}
  #${ID} .toolbar{display:flex;flex-wrap:wrap;gap:6px;padding:6px;background:#0b0d12;border:1px solid #23262d;border-radius:10px}
  #${ID} .toolbar button{background:#17202f}
  #${ID} .editor{min-height:220px;background:#11151d;border:1px solid #23262d;border-radius:12px;padding:12px;overflow:auto}
  #${ID} .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  #${ID} .blk{background:#0b0d12;border:1px solid #23262d;border-radius:10px;padding:8px}
  #${ID} .blk h4{margin:0 0 6px;font:600 13px system-ui;color:#c9d7ff}
  #${ID} .blk .ed{min-height:120px;background:#11151d;border:1px solid #23262d;border-radius:8px;padding:8px;overflow:auto}
  #${ID} .blk .mini{display:flex;gap:8px;align-items:center;margin:6px 0 8px}
  #${ID} .blk .mini select{background:#0f1522;color:#eaeef3;border:1px solid #2a2f3a;border-radius:8px;padding:6px 8px}
  #${ID} .blk .mini button{background:#17202f}
  #${ID} details.ed-wrap{background:#0b0d12;border:1px solid #23262d;border-radius:10px}
  #${ID} details.ed-wrap>summary{cursor:pointer;padding:8px 10px;user-select:none;list-style:none;color:#c9d7ff}
  #${ID} details.ed-wrap[open] .toolbar, #${ID} details.ed-wrap[open] .editor{display:block}
  #${ID} details.ed-wrap:not([open]) .toolbar, #${ID} details.ed-wrap:not([open]) .editor{display:none}
  .meta-preview{font:13px/1.5 system-ui;background:#11151d;border:1px solid #23262d;border-radius:8px;padding:8px;margin-top:6px;color:#ccc}
  .meta-preview div{margin-bottom:4px}
  .boldlist{display:flex;flex-direction:column;gap:8px;margin-top:8px}
  .bolditem{display:grid;grid-template-columns:1fr 130px;gap:8px;align-items:center;background:#0b0d12;border:1px solid #23262d;border-radius:8px;padding:8px}
  .bolditem .txt{font:13px/1.5 system-ui;color:#eaeef3;word-break:break-word}
  .bolditem select{background:#0f1522;color:#eaeef3;border:1px solid #2a2f3a;border-radius:8px;padding:6px 8px}
  .bold-actions{display:flex;gap:8px;margin-top:8px}
  #${ID} .md-hint{font:12px/1.4 system-ui;color:#9aa6b2;margin-top:-4px;margin-bottom:6px}
  #${ID} #${ID}-md{width:100%;min-height:160px;background:#12151c;color:#eaeef3;border:1px solid #2a2f3a;border-radius:10px;padding:10px 12px;font:13px/1.5 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}

  @keyframes nppePulse {0%{box-shadow:0 0 0 0 rgba(42,109,245,.65)}70%{box-shadow:0 0 0 10px rgba(42,109,245,0)}100%{box-shadow:0 0 0 0 rgba(42,109,245,0)}}
  .nppe-pulse{animation:nppePulse 1.2s ease-out 1; outline:2px solid #2a6df5; outline-offset:2px; border-radius:8px}
  `;
    const style = Object.assign(document.createElement("style"), { id: ID + "-style", textContent: css });
    document.head.appendChild(style);
    const wrap = Object.assign(document.createElement("div"), { id: ID });
    wrap.innerHTML = `
    <div class="box">
      <div class="hd">
        <h3>NPPE \u2013 Paste Filler (Modular v2)</h3>
      </div>
      <div class="bd">
        <div class="col">
          <label><b>Modelo de mapeamento:</b></label>
          <select id="${ID}-model"></select>
          <div>
            <label><b>.docx (opcional):</b></label>
            <input id="${ID}-docx" type="file" accept=".docx">
          </div>
        <div>
<label><b>Markdown (opcional):</b></label>
<div class="md-hint">Cole aqui seu conte\xFAdo em Markdown. Em <i>Analisar</i>, ele ser\xE1 convertido e enviado ao Editor.</div>
<textarea id="${ID}-md" placeholder="# T\xEDtulo

Intro (H3):
Texto...

**Negrito** e _it\xE1lico_, listas:
- item
1. item

[link](https://exemplo.com)"></textarea>
          </div>
          <div class="log" id="${ID}-log">Pronto\u2026</div>
        </div>
        <div class="col">

          <!-- Meta & H1 -->
          <details class="ed-wrap" id="${ID}-meta-wrap">
            <summary>Meta & H1</summary>
            <div class="blk"><h4>H1</h4><div id="${ID}-h1" class="ed" contenteditable="true"></div></div>
            <div class="meta-preview" id="${ID}-meta-preview"></div>
          </details>

          <!-- Bold \u2192 Headings -->
          <details class="ed-wrap" id="${ID}-bold-wrap">
            <summary>Bold \u2192 Headings (H2/H3/H4)</summary>
            <div class="meta-preview">Selecione abaixo como cada senten\xE7a em negrito deve virar heading. Convers\xF5es ser\xE3o aplicadas no Editor e nos Blocos.</div>
            <div id="${ID}-bold-list" class="boldlist"></div>
            <div class="bold-actions">
              <button class="secondary" id="${ID}-bold-rescan">Revarrer bolds</button>
              <button id="${ID}-bold-apply">Aplicar convers\xF5es</button>
            </div>
          </details>

          <details class="ed-wrap" id="${ID}-ed-wrap">
            <summary>Editor (opcional)</summary>
            <div class="toolbar">
            <button type="button" data-act="md-to-editor" title="Converter Markdown para Editor">MD\u2192Editor</button></div>
            <div id="${ID}-editor" class="editor" contenteditable="true" aria-label="Editor (tipo CK)"></div>
          </details>

          <div class="grid2" style="margin-top:10px">
            <div class="blk"><h4>Intro (H3)</h4><div id="${ID}-intro" class="ed" contenteditable="true"></div></div>
            <div class="blk"><h4>Text block 1</h4><div id="${ID}-t1" class="ed" contenteditable="true"></div></div>
            <div class="blk"><h4>Image+Text 1 (summary)</h4><div id="${ID}-i1" class="ed" contenteditable="true"></div></div>
            <div class="blk"><h4>Text block 2</h4><div id="${ID}-t2" class="ed" contenteditable="true"></div></div>
            <div class="blk"><h4>Image+Text 2 (summary)</h4><div id="${ID}-i2" class="ed" contenteditable="true"></div></div>
            <div class="blk"><h4>Text block 3</h4><div id="${ID}-t3" class="ed" contenteditable="true"></div></div>
          </div>
        </div>
      </div>
      <div class="btns">
        <button class="secondary" id="${ID}-sanitize">Sanitizar</button>
        <button class="secondary" id="${ID}-autotag">Auto-Tag</button>
        <button class="secondary" id="${ID}-analyze">Analisar</button>
        <button id="${ID}-fill">Preencher Drupal</button>
        <button class="secondary" id="${ID}-close">Fechar</button>
      </div>
    </div>
  `;
    document.body.appendChild(wrap);
    const $ = (sel) => wrap.querySelector(sel);
    const $model = $(`#${ID}-model`);
    const $docx = $(`#${ID}-docx`);
    const $md = $(`#${ID}-md`);
    const $log = $(`#${ID}-log`);
    const $ed = $(`#${ID}-editor`);
    const $h1 = $(`#${ID}-h1`);
    const $metaPreview = $(`#${ID}-meta-preview`);
    const $boldList = $(`#${ID}-bold-list`);
    const $boldRescan = $(`#${ID}-bold-rescan`);
    const $boldApply = $(`#${ID}-bold-apply`);
    const $autotag = $(`#${ID}-autotag`);
    const $sanitize = $(`#${ID}-sanitize`);
    const $analyze = $(`#${ID}-analyze`);
    const $fill = $(`#${ID}-fill`);
    const $close = $(`#${ID}-close`);
    const $intro = $(`#${ID}-intro`), $t1 = $(`#${ID}-t1`), $t2 = $(`#${ID}-t2`), $t3 = $(`#${ID}-t3`), $i1 = $(`#${ID}-i1`), $i2 = $(`#${ID}-i2`);
    const log = (...a) => {
      $log.textContent = a.join(" ");
    };
    (() => {
      const keys = Object.keys(MODELS);
      $model.innerHTML = keys.map((k) => `<option value="${k}">${k}</option>`).join("");
      if (keys.length) $model.value = keys[0];
    })();
    $close.onclick = () => {
      wrap.remove();
      style.remove();
    };
    $model.onchange = () => {
      const k = $model.value;
      const m = MODELS[k];
      if (m) log("Modelo selecionado:", k, "\nURL:", m.url);
    };
    $docx.onchange = async () => {
      if (!$docx.files[0]) return;
      try {
        log("Lendo DOCX...");
        const html = await getDocxHTML($docx.files[0]);
        $ed.innerHTML = html;
        log('DOCX carregado no Editor. Clique em "Analisar" para distribuir nos blocos.');
      } catch (e) {
        console.error(e);
        log("Erro ao ler DOCX:", e.message);
      }
    };
    $sanitize.onclick = () => {
      const clean = sanitizeHTML($ed.innerHTML);
      $ed.innerHTML = clean;
      log("HTML sanitizado.");
    };
    $analyze.onclick = () => {
      if ($md.value.trim()) {
        $ed.innerHTML = markdownToHTML($md.value);
      }
      const html = $ed.innerHTML;
      const res = parseArticle(html);
      $h1.innerText = res.h1;
      $metaPreview.innerHTML = `
      <div><b>Meta Title:</b> ${esc(res.metaTitle)}</div>
      <div><b>Meta Desc:</b> ${esc(res.metaDesc)}</div>
      <div><b>OG Title:</b> ${esc(res.ogTitle)}</div>
      <div><b>OG Desc:</b> ${esc(res.ogDesc)}</div>
      <div><b>URL Alias:</b> ${esc(res.urlAlias)}</div>
      <div style="margin-top:6px;font-size:0.9em;color:#666">
        Componentes detectados: ${res.components.length}
        ${res.components.length ? " (Modo Template)" : " (Modo Standard)"}
      </div>
    `;
      $log.dataset.meta = JSON.stringify(res);
      $intro.innerHTML = res.intro;
      $t1.innerHTML = res.t1;
      $t2.innerHTML = res.t2;
      $t3.innerHTML = res.t3;
      if (res.imgBlocks && res.imgBlocks.length) {
        $i1.innerHTML = res.imgBlocks[0]?.summary || "";
        $i2.innerHTML = res.imgBlocks[1]?.summary || "";
      } else {
        $i1.innerHTML = "(Ver componentes)";
        $i2.innerHTML = "(Ver componentes)";
      }
      log("An\xE1lise conclu\xEDda.");
    };
    $fill.onclick = async () => {
      if (!$log.dataset.meta) {
        log("Analise o conte\xFAdo primeiro.");
        return;
      }
      const meta = JSON.parse($log.dataset.meta);
      try {
        const resultLog = await fillDrupal(meta, { $intro, $t1, $t2, $t3, $i1, $i2 });
        log(resultLog);
      } catch (e) {
        console.error(e);
        log("Erro no preenchimento:", e.message);
      }
    };
    wrap.querySelector(".toolbar").addEventListener("click", (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;
      const act = btn.dataset.act;
      if (act === "md-to-editor") {
        const md = $md.value;
        if (!md.trim()) {
          alert("Cole Markdown na caixa acima primeiro.");
          return;
        }
        $ed.innerHTML = markdownToHTML(md);
      }
    });
    const firstBlock = (ed) => {
      const isBlock = (n2) => n2 && n2.nodeType === 1 && /^(P|H2|H3|UL|OL)$/i.test(n2.tagName) && n2.textContent.trim() !== "";
      let n = ed.firstChild;
      while (n && !isBlock(n)) n = n.nextSibling;
      return n;
    };
    const applyHeading = (ed, level) => {
      let n = firstBlock(ed);
      if (!n) {
        n = document.createElement("p");
        n.innerHTML = "";
        ed.prepend(n);
      }
      if (level === "p" && n.tagName !== "P") {
        const p = document.createElement("p");
        p.innerHTML = n.innerHTML;
        n.replaceWith(p);
        return;
      }
      if (level === "h2" || level === "h3") {
        const tag = level.toUpperCase();
        if (n.tagName !== tag) {
          const hx = document.createElement(tag);
          hx.innerHTML = n.innerHTML;
          n.replaceWith(hx);
        }
      }
    };
    const listifyRest = (ed) => {
      const start = firstBlock(ed);
      if (!start) return;
      const toList = [];
      for (let n = start.nextSibling; n; n = n.nextSibling) {
        if (n.nodeType === 1 && n.tagName === "P" && n.textContent.trim() !== "") toList.push(n);
      }
      if (toList.length < 2) return;
      const ul = document.createElement("ul");
      toList.forEach((p) => {
        const li = document.createElement("li");
        li.innerHTML = p.innerHTML;
        ul.appendChild(li);
      });
      toList.forEach((p) => p.remove());
      ed.insertBefore(ul, start.nextSibling);
    };
    wrap.querySelectorAll(".grid2 .blk").forEach((blk, idx) => {
      const ed = blk.querySelector(".ed");
      const mini = document.createElement("div");
      mini.className = "mini";
      mini.innerHTML = `
      <label>N\xEDvel</label>
      <select data-level>
        <option value="h2">H2</option>
        <option value="h3" ${idx === 0 ? "selected" : ""}>H3</option>
        <option value="p"  ${idx !== 0 ? "selected" : ""}>Par\xE1grafo</option>
      </select>
      <button type="button" data-act="listify">Par\xE1grafos \u2192 Lista</button>
    `;
      blk.insertBefore(mini, ed);
      const sel = mini.querySelector("select");
      const btn = mini.querySelector("button");
      sel.addEventListener("change", (e) => applyHeading(ed, e.target.value));
      btn.addEventListener("click", () => listifyRest(ed));
    });
    log("Painel carregado.");
  };

  // src/main.js
  (() => {
    "use strict";
    console.log("NPPE Paste Filler (Modular) initializing...");
    createPanel();
  })();
})();
